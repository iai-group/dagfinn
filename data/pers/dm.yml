version: "3.0"

rules:

  - rule: Greet known user
    steps:
    - intent: greet
    - slot_was_set:
      - known_user: True
    - action: utter_greet_again

  - rule: Recognize user
    steps:
    - intent: recognize_me
    - action: action_recognize_user
    - action: utter_how_can_help

  - rule: Activate name form 
    steps:
    - intent: consent_for_research
    - action: name_form
    - active_loop: name_form

  - rule: Read user's name from the qr code
    steps:
    - intent: ask_read_qr_code
    - action: utter_ask_show_closer_qr_code
    - action: action_read_qr_code

  - rule: Take pictures of the user
    steps:
    - intent: ask_can_you_take_pictures
    - action: utter_ask_to_smile
    - action: action_take_pictures

  - rule: Submit name form 
    condition:
    - active_loop: name_form
    steps:
    - action: name_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: utter_submit
    - action: utter_name_form_slots_values
    - action: action_write_to_db
    - action: action_take_pictures

stories:
- story: Happy path of name form
  steps:
  - action: name_form
  - active_loop: name_form
  - slot_was_set:
    - requested_slot: first_name
  - slot_was_set:
    - first_name: Ekaterina
  - slot_was_set:
    - requested_slot: null
  - slot_was_set:
    - requested_slot: names_correct
  - slot_was_set: 
    - names_correct: True
  - slot_was_set:
    - requested_slot: null
  - active_loop: null
  - action: utter_submit
  - action: utter_name_form_slots_values
  - action: action_write_to_db
  - action: action_take_pictures


- story: User interrupts the name form and doesn't want to continue
  steps:
  - action: name_form
  - active_loop: name_form
  - intent: stop
  - action: utter_ask_continue
  - or: 
    - intent: stop
    - intent: affirm
  - action: action_deactivate_loop
  - active_loop: null


  
